# UX 评审与验收清单（desktop-mvp-foundation）

> 评审输入：`docs/specs/desktop-mvp-foundation/02-ux-spec.md`、`docs/product/user-flows.md`
> 
> 评审目标：把 UX Spec 转成可执行验收清单，并识别阻塞性 UX 风险（重点 Empty/Loading/Error 与可恢复路径）。

## 1) 问题清单（按严重性）

### Blocker（会导致任务无法完成或不可恢复）

1. **“未配置 Provider 是否允许生成”存在规则冲突**
   - `02-ux-spec.md`：未配置 Provider 时“生成按钮不可用”。
   - `user-flows.md`：未配置在线 Provider 时“文本仍可走本地/降级逻辑”，但图片会失败。
   - 风险：同一场景有两套验收口径，QA 无法判定通过标准。
   - 需要定稿：MVP 到底是“全部生成都依赖 Provider”，还是“文本可降级、图片必须 Provider”。

2. **“取消全部”与“任务可恢复”缺少强约束语义**
   - UX Spec 提到取消与重试，但未强定义“是否可中断 in-flight 请求”。
   - 风险：用户误以为“立即全部停止”，实际只停止排队，造成信任损失。
   - 需要定稿：取消语义、队列状态迁移（queued/running/canceled/failed/succeeded）和文案必须一致。

3. **删除当前版本后的回退规则未写入强制验收语句**
   - UX Spec 有示例文案，但未在“必须行为”中明确“删除当前版本后 UI 指针不得悬空”。
   - 风险：出现“当前版本已删但详情仍指向不存在记录”，用户无法恢复。
   - 需要定稿：删除成功后必须自动回退到最近版本；若无版本则进入空状态。

### Major（显著增加认知负担/高概率误操作）

1. **Success 状态定义偏弱**
   - Empty/Loading/Error 非常完整，但“保存成功/切换成功/删除成功/重试成功”的反馈模式不统一。
   - 建议：统一采用“轻提示 + 可定位结果”的成功反馈。

2. **effective prompt 与 promptContext 的编辑边界不够清晰**
   - 目前强调可见可编辑，但缺“何时持久化、何处回显为真相源”的规范。
   - 风险：用户改了 prompt 却不确定是否生效，导致重复操作。

3. **错误信息可读性依赖后端透传，前端兜底策略未固化**
   - UX Spec 要求“给出具体原因”，但未定义“后端只返回通用错误码时的文案映射”。
   - 风险：最终仍会落成“未知错误”。

4. **自动生成预览图的额度感知仍可能不充分**
   - 有确认文案，但未强制显示“本次将生成张数/预计消耗范围/可在设置修改策略”。

### Minor（一致性/微文案/可访问性）

1. 术语统一：建议全站固定为 `最终提示词（effective prompt）`。
2. 弹窗结构统一：影响范围、不可恢复性、下一步动作顺序保持一致。
3. 可访问性文案补充：任务状态图标需可读文本，避免仅颜色区分成功/失败。

## 2) 状态覆盖检查（逐条对照 UX Spec）

### 2.1 Empty

| 条目 | 是否覆盖 | 是否有恢复动作 | 评审结论 |
| --- | --- | --- | --- |
| 首次启动：无资产/无项目 | 是 | 是（创建资产/新建项目并回跳） | 通过 |
| 资产列表为空 | 是 | 是（新建并自动选中） | 通过 |
| 未配置 Provider | 是 | 是（去设置并返回原位） | 通过（但与 `user-flows` 规则冲突，见 Blocker-1） |
| 版本历史为空 | 是 | 是（生成第一个版本） | 通过 |

### 2.2 Loading

| 条目 | 是否覆盖 | 是否有恢复动作 | 评审结论 |
| --- | --- | --- | --- |
| 方案生成中 | 是 | 是（取消/稍后通知/失败可重试） | 通过（需明确取消语义） |
| 批量预览图生成中 | 是 | 是（取消全部/失败项重试） | 通过（需明确 in-flight 行为） |
| 拉模型/测试连接 | 是 | 是（取消/重试/保留表单） | 通过 |
| 上传图片/写文件 | 是 | 是（重试/改存储路径） | 通过 |

### 2.3 Error

| 条目 | 是否覆盖 | 是否有恢复动作 | 评审结论 |
| --- | --- | --- | --- |
| 无 Key/未配置 Provider | 是 | 是（去设置） | 通过 |
| 401/403 鉴权失败 | 是 | 是（编辑配置并重测） | 通过 |
| 超时/网络不可用 | 是 | 是（重试/检查网络） | 通过 |
| 模型能力不支持 | 是 | 是（切换模型） | 通过 |
| JSON 解析失败 | 是 | 是（重试/查看原始输出） | 通过 |
| 图片生成失败（单张/部分） | 是 | 是（单张重试/失败项重试） | 通过 |
| 本地写入失败 | 是 | 是（改存储位置/重试） | 通过 |
| 版本删除失败 | 是 | 是（刷新/复制详情/重试） | 通过 |

### 2.4 Success（建议补齐为强规范）

| 条目 | 当前定义 | 建议 |
| --- | --- | --- |
| 保存成功 | 弱定义 | 2 秒轻提示 + 页面状态已保存标记 |
| 生成成功 | 弱定义 | 任务队列标记完成，并提供“查看结果”入口 |
| 切换版本成功 | 弱定义 | 版本控件给出已切换反馈 |
| 删除成功 | 弱定义 | 明确“已删除 N 个版本（不可恢复）” |

## 3) 验收场景（可执行，18 条）

> 说明：每条包含前置条件、操作、期望结果；至少覆盖首次使用、无数据、无 Provider/无 Key、超时、模型不支持、部分失败与重试/恢复。

1. **首次使用无资产无项目**：前置=全新数据；操作=打开应用；期望=出现双 CTA 空态，完成创建后自动回到来源流程。
2. **资产列表为空（道具）**：前置=道具类型无数据；操作=进入道具页；期望=空态说明 + 新建 CTA，新建后自动选中并打开详情。
3. **无 Provider 触发生成（规则校验）**：前置=未配置 Provider；操作=在项目页点击生成；期望=行为与最终产品规则一致（禁用或允许文本降级）且解释清楚。
4. **无 Key 场景**：前置=Provider 存在但无 API Key；操作=触发图片生成；期望=明确提示缺少 Key，提供直达设置并保留当前输入。
5. **401/403 鉴权失败**：前置=配置错误 Key；操作=测试连接或发起生成；期望=错误可读、支持回填编辑并重试。
6. **网络离线/超时**：前置=断网或代理不可达；操作=触发生成；期望=展示超时/离线提示，可重试并可跳转网络相关设置。
7. **模型不支持图片能力**：前置=选择 text-only 模型；操作=触发图片生成；期望=提示能力不匹配并可直达模型切换。
8. **方案 JSON 非法**：前置=模拟返回非法 JSON；操作=生成方案；期望=提示“格式异常”，可重新生成并查看原始输出。
9. **单张图片失败**：前置=单卡片生成失败；操作=在失败卡点击重试；期望=仅该卡片重试，不影响其他已完成卡片。
10. **批量生成部分失败**：前置=10 张任务中 3 张失败；操作=查看结果；期望=成功项保留，失败项可“逐个重试/重试失败项”。
11. **批量取消全部**：前置=批量任务进行中；操作=点击取消全部；期望=后续排队停止，若 in-flight 不能中断需明确提示。
12. **任务队列恢复能力**：前置=存在失败任务；操作=切页后回到任务抽屉；期望=仍可见失败记录、错误详情、重试入口。
13. **effective prompt 编辑生效**：前置=场景卡已有 prompt；操作=编辑后点击重新生成；期望=生成新版本，UI 显示回显的 effective prompt。
14. **版本切换成功反馈**：前置=至少 2 个版本；操作=切换版本；期望=主图与元信息立即更新，并有轻量成功反馈。
15. **删除非当前版本**：前置=存在可删历史版本；操作=删除；期望=二次确认后删除成功，列表即时更新。
16. **删除当前版本回退**：前置=当前版本为可删；操作=删除当前版本；期望=自动回退到最近版本；若无版本则进入空状态。
17. **本地写入失败恢复**：前置=磁盘满或无权限；操作=保存图片；期望=明确失败原因，可改存储路径后重试成功。
18. **文案兜底检查**：前置=注入未分类异常；操作=触发错误；期望=不出现仅“未知错误”，至少提供原因线索 + 下一步动作 + 复制详情。

## 4) 文案与反馈质量检查

### 4.1 硬性规则

1. 禁止仅出现“未知错误”。
2. 每条错误文案必须包含：发生了什么、可判定原因、下一步动作。
3. 所有高风险操作（删除版本、批量生成消耗额度、批量清理）必须二次确认并写明影响范围。
4. 所有失败态至少提供一个可执行恢复动作（重试、去设置、切换模型、复制错误详情）。

### 4.2 建议文案模板

- 未配置 Provider：`尚未配置 AI Provider，当前无法生成。去设置完成后可继续。`
- 鉴权失败：`鉴权失败：API Key 无效或已过期。请更新 Key 后重试。`
- 网络超时：`请求超时或网络不可用。请检查网络后重试。`
- 模型能力不匹配：`当前模型不支持图片生成，请切换到具备 image 能力的模型。`
- JSON 解析失败：`生成结果格式异常，暂时无法解析为方案。可重新生成或查看原始输出。`
- 批量生成确认：`将生成 {n} 张预览图，可能消耗额度，确认继续吗？`
- 取消全部提示：`将停止后续任务；正在生成的任务可能仍会完成。`
- 删除当前版本确认：`删除后将自动切换到最近版本；若无版本将进入空状态。`

## 5) 结论

- 当前 UX Spec 对 Empty/Loading/Error 的覆盖**完整度高**，且大多数状态已给出恢复路径。
- 阻塞项集中在“规则冲突与语义未定稿”：尤其是 `无 Provider 是否允许文本降级`、`取消全部是否中断 in-flight`、`删除当前版本后的强一致回退`。
- 建议先把 3 个 Blocker 形成单一产品口径，再进入实现与联调，否则验收标准会分裂。
