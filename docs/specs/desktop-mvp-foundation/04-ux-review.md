# UX 评审与验收清单（desktop-mvp-foundation）

> 基于：`docs/specs/desktop-mvp-foundation/02-ux-spec.md`  
> 参考：`docs/product/user-flows.md`  
> 重点：Empty/Loading/Error 的恢复路径、版本管理（可清理）、effective prompt 可编辑与一致性、任务队列可观测性

## 1) 问题清单（按严重性）

### Blocker（会导致任务无法完成或不可恢复）

1. **自动生成预览图的“成本/额度”护栏已决策**
   - 决策：采用“首次授权（记住选择）”，并提供策略：`关 / 封面+N / 全部`（见 ADR 0003）。
   - 验收重点：首次触发前弹窗必须写清“张数 + 可能消耗额度 + 可在设置修改”，之后按用户策略自动执行且不重复打扰。

2. **任务队列可恢复性已决策**
   - 决策：任务队列保留失败与完整历史，失败任务支持“重试”（重试应创建新任务以保留历史）（见 ADR 0005）。
   - 验收重点：用户任何时候都能从任务队列找到失败记录、查看错误并重试；并可筛选 `进行中/失败/全部`。

3. **删除“当前版本”后的回退规则已决策**
   - 决策：允许删除任何版本；删除当前版本时自动回退到最近版本；若无版本则进入空状态（见 ADR 0004）。
   - 验收重点：删除确认必须写清回退行为；删除后 UI 与指针永不悬空。

### Major（显著增加认知负担/高概率误操作）

1. **“取消全部”语义需对齐真实能力**
   - 若底层无法中断 running 任务（常见），UI 必须说明：取消只会停止后续排队，正在生成的可能仍会完成。

2. **effective prompt 编辑的持久化与回显策略需更明确**
   - 需要在组件层确认：
     - 用户编辑的是“本次要生成的草稿 prompt”还是“当前版本的 prompt”？
     - 点击生成后，服务端回显的 effective prompt 作为真相源，UI 以回显覆盖显示（避免不一致）。

3. **版本管理的“信息密度 vs 极简”平衡需明确交互形态**
   - 建议统一版本列表最小字段：缩略图（图片类）/时间/来源/是否当前/是否含预览图；其余信息折叠。

4. **“修改上下文（promptContext）”的 MVP 边界需定义**
   - 目前 UX Spec 折叠展示 promptContext，但未定义“可编辑项”。
   - 建议 MVP 先只做：
     - 显示上下文来源（只读）
     - 允许编辑 effective prompt（可控且立即见效）
   - 上下文结构化编辑（例如开关某个资产/标签对 prompt 的影响）可留到后续（否则 UI 复杂度上升很快）。

5. **成功态反馈（Success States）仍偏隐式**
   - UX Spec 对 Empty/Loading/Error 很完整，但对“保存成功/生成成功/切换版本成功/删除成功”缺少统一反馈模式。
   - 建议最小模式：页面内轻量 toast + 状态标签（不打扰但可确认）。

### Minor（一致性/微文案/可访问性等）

1. 术语一致性：建议统一使用 `最终提示词（effective prompt）`，不要在不同页面用“提示词/生图提示词/最终提示词”混用。
2. 文案尽量短：极简风格下，长段落说明应折叠到 `为什么`/`了解更多`。
3. 快捷键提示：在按钮 tooltip 或命令面板中展示，避免强引导教程。
4. 删除/清理确认弹窗：统一结构（影响范围 → 不可恢复提示 → 取消/确认）。

## 2) 状态覆盖检查（对照 UX Spec）

### Empty / Loading / Error 覆盖情况

- Empty States：4 个（✅）且均给出 CTA 与恢复路径（✅）
  - 首次启动无资产/无项目（✅）
  - 资产列表为空（✅）
  - 未配置 Provider（✅）
  - 版本历史为空（✅）
- Loading States：4 个（✅）且均给出恢复路径（✅）
  - 生成方案（✅）
  - 批量生成预览图（✅）
  - 拉模型/测试连接（✅）
  - 上传图片/写文件（✅）
- Error States：8 个（✅）且均给出下一步（✅）
  - 未配置/无 Key、401/403、超时/离线、模型不支持、JSON 不合法、图片生成失败、写文件失败、版本删除失败（✅）

### Success States（建议补齐为“统一模式”）

目前 Success 主要是“自然发生”（例如生成完成后图片出现、保存后返回列表），建议补齐统一且极简的成功反馈模式：

- 保存成功：右上角轻量 toast `已保存`（2s 自动消失），并在标题行显示 `已保存 · 刚刚`
- 生成成功：任务队列显示 `已完成`（可点“查看结果/查看图片版本”）
- 切换版本成功：版本选择器旁显示 `当前版本已切换`
- 删除版本成功：显示 `已删除 1 个版本`（可选显示估算大小）

## 3) 验收场景（10–20 条，可执行）

> 建议优先跑 Phase A（流程内 Lite 闭环），全局 AI/skills 作为 Phase B 的单独验收集。

1. **首次启动（无资产/无项目）**
   - 期望：出现空态，主 CTA“创建第一个场景”；创建完成后能回到项目创建或资产详情。

2. **资产列表为空（道具为空）**
   - 期望：显示空态解释 + CTA；新建后自动选中并打开详情。

3. **未配置 Provider 时触发生成方案**
   - 操作：在项目页点“生成”
   - 期望：按钮 disabled + inline 提示；点击“去设置”直达 Provider；配置完成返回后生成可用，且已选资产不丢。

4. **Provider 401/403**
   - 操作：填错 Key → 测试连接
   - 期望：错误文案可读；提供“编辑 Provider/重新测试”；不清空表单。

5. **网络离线/超时**
   - 操作：断网后触发生成
   - 期望：提示“超时/离线”与“重试/检查网络”；恢复网络后可重试成功。

6. **模型不支持图片能力**
   - 操作：选择 text-only 模型触发图片生成
   - 期望：明确提示“模型不支持图片”；提供直达切换模型入口；切换后回到原处继续。

7. **方案生成 JSON 不合法**
   - 操作：模拟 LLM 返回非 JSON（或服务端报解析错误）
   - 期望：提示“无法解析”；提供“重新生成/查看原始输出（可复制）”。

8. **生成方案成功后自动预览图（封面+N）**
   - 期望：生成完成后自动进入预览图生成队列；页面与任务抽屉都有进度；完成后预览图出现。

9. **自动预览图的首次授权/确认（若采用）**
   - 期望：首次自动触发前弹出确认（说明张数与可能消耗额度）；用户拒绝后不自动生成，但可手动触发。

10. **批量生成预览图：取消全部**
   - 操作：开始批量 → 点击取消
   - 期望：停止后续排队；已完成的保留；UI 明确说明“正在生成的可能仍会完成”（若无法硬取消）。

11. **单张图片生成失败（部分失败）**
   - 期望：失败卡片内展示错误；提供“重试/编辑提示词后重试”；其它卡不受影响。

12. **effective prompt 可见、可编辑、可复用**
   - 操作：展开 prompt → 编辑 → 重新生成
   - 期望：新版本生成；服务端回显 effective prompt；UI 显示与回显一致。

13. **图片版本管理：切换/设为主图**
   - 期望：版本列表可切换；设为主图后，列表/卡片主图立即更新；刷新后仍一致。

14. **版本删除：删除非当前版本**
   - 期望：二次确认；删除后版本消失；磁盘文件被清理（可通过存储占用变化或文件不存在验证）。

15. **版本删除：尝试删除当前版本**
   - 期望：按产品规则：
     - 要么禁止并提示先切换版本，
     - 要么允许但明确“将切换到最近版本/无版本进入空态”，并保证可恢复。

16. **本地写入失败（磁盘满/无权限）**
   - 操作：模拟写入失败后生成图片
   - 期望：提示原因与“更换存储位置/重试”；更换后可继续生成并落盘。

17. **任务队列可恢复性**
   - 操作：让一个任务失败，然后关闭抽屉/切换页面
   - 期望：用户仍能从任务队列找到失败记录与错误详情，并能重试。

18. **（Phase B 可选）全局 AI 的可执行动作需要确认**
   - 期望：AI 输出“动作卡片”；未确认不执行；确认后执行结果可见且可追溯。

## 4) 文案与反馈质量检查

### 必须达标（硬性）

- 禁止出现“未知错误”作为唯一反馈；必须至少提供：
  - 可读错误原因（能判定则判定）
  - 下一步动作（重试/去设置/切换模型/复制错误详情）
- 所有“不可恢复动作”必须二次确认，并写清：
  - 删除的是“记录 + 本地文件”
  - 是否影响当前版本
  - 是否可恢复（默认不可恢复）

### 建议统一的关键文案（可直接复用）

- effective prompt 区标题：`最终提示词（effective prompt，可编辑）`
- 批量生成确认：`将生成 {n} 张预览图，可能消耗额度。确定继续吗？`
- 取消全部（若无法中断 running）：`将停止后续任务，正在生成的图片可能仍会完成。`
- 删除当前版本（允许删除的情况下）：`删除后将自动切换到最近版本；若无版本将进入空状态。`
