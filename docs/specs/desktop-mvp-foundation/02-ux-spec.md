# 桌面端 MVP 基础：UX Spec（Desktop MVP Foundation）

> FEATURE_SLUG: `desktop-mvp-foundation`  
> 交互取向：自动化优先（按风险分级 + 可撤销/可追溯）  
> 风格偏好：极简 + 信息密度（渐进披露，不做教学式引导）  
> 范围：Phase A（流程内 Lite 闭环）为本次实现目标；Phase B（全局 AI Agent/Skills）仅做占位与约束，不阻塞 Phase A。  
> Low-fi：见 `docs/specs/desktop-mvp-foundation/05-wireframes.md`  
> 说明：本 UX Spec 以“桌面应用”为默认心智模型（多面板、可并行任务、文件/版本管理是常态），但实现仍基于 Web UI 技术栈。

## 1) Mental Model（心智模型）

用户把应用理解为「工作室的创意与资源操作系统」，由三类对象构成：

1. **资产（Assets）**：可长期复用的“素材与知识”。场景/道具/服装/提示词预设都属于资产，资产可被检索、被引用、被版本化（尤其是图片）。
2. **项目（Projects）**：一次拍摄/一次创意任务的容器。项目引用若干资产，产出一份或多份“创意方案版本”。
3. **生成与版本（Generations & Versions）**：任何“生成类动作”都会产生一个版本（文本方案版本、图片版本），用户可以切换/删除来保持可控与可清理。

在 UI 中，AI 不应被理解为“黑盒按钮”，而是：

- **流程内 AI（Lite）**：在用户正在做的流程里，提供“生成/重新生成/重新编辑”的最小闭环；最关键的是 **effective prompt 可见且可编辑**，版本可回溯。
- **全局 AI（Agent，Phase B）**：更像“命令行/助理”，通过结构化调用后端 API 来执行动作，但必须遵循“可确认、可观测、可回滚（至少可追溯）”。

自动化的代价与护栏（本期默认策略）：

- 代价（为什么“自动化省事”不是免费午餐）：
  - **信任成本**：AI 若“擅自做事”，用户会不敢用；尤其涉及删除/批量改动/花费额度/写文件。
  - **状态复杂度**：更多后台任务（生成/批量/版本）意味着更多 Loading/Error 分支与恢复路径。
  - **可解释性要求**：必须解释“这张图/这版方案到底用了什么 prompt/上下文”，否则无法复用与稳定迭代。
- 护栏（让它自动化但仍然可控）：
  - **按风险分级**：低风险动作可自动执行；高风险动作必须二次确认。
  - **版本化默认开启**：所有生成/编辑都产生新版本，不覆盖旧版本；用户可清理。
  - **任务队列可见**：任何耗时操作都进入任务队列；任务抽屉保留失败与完整历史，并支持重试。
  - **预览图自动化需首次授权**：生成方案后自动生成预览图属于“会额外消耗额度”的自动化，首次触发前必须让用户选择策略并可记住（见 ADR 0003）。

## 2) Information Architecture（信息架构/默认焦点）

### 顶层 IA（全局）

- 顶层入口建议保持 3 个：`项目` / `资产` / `设置`
- 全局常驻能力：
  - **任务队列入口**：显示后台生成任务进度（生成方案、批量预览图、图片编辑/生成），并可切换查看 `进行中/失败/全部` 历史，失败任务可 `重试`
  - **全局 AI 入口（Phase B）**：右上角“AI 助手”按钮 + 快捷键（例如 `⌘K` 打开命令面板，`⌘/` 打开对话）

默认焦点（首次启动时的落点规则）：

1. 若无任何资产：默认把焦点放在 `资产 > 场景`（因为后续生成依赖它）。
2. 若已有资产但无项目：默认把焦点放在 `项目` 的新建入口。
3. 若用户尝试生成但未配置 Provider：默认把焦点放在 `设置 > AI Provider`。

### Projects（项目）

- Projects List：卡片/列表（桌面优先列表 + 快速筛选：最近、状态、标签）
- Project Detail：流程式步骤（固定步骤 UI）+ 右侧版本/任务状态
  - Step 1 选择资产（场景/道具/服装/提示词预设）
  - Step 2 生成方案（创建新“方案版本”）
  - Step 3 查看方案（含预览图、版本切换与清理）

### Assets（资产）

资产页建议采用“类型切换 + 列表/详情”结构：

- 资产类型：场景 / 道具 / 服装 / 提示词预设
- 每个类型都有：
  - 列表：搜索、标签筛选、排序（最近更新/最近使用）
  - 详情：基础信息表单 + 图片区（含 Image Studio Lite）+ 版本历史

### Settings（设置）

保持 2–3 个分组即可：

- AI Provider（添加/测试/默认/模型选择）
- 前置系统提示词管理
- 存储与缓存（数据目录、图片缓存、空间占用）
- 主题示例/预设（若仍保留旧首页示例主题能力）

## 3) Affordance（可发现性/关键交互显性提示）

### 关键 CTA（按优先级）

- 空状态主按钮：`创建第一个场景`、`新建项目`、`去设置 AI Provider`
- 生成按钮（项目/图片）：使用主色强调；当不可用时不隐藏，改为 disabled + 解释文案（可点击打开“为什么不可用”）
- 版本入口：必须常显（而不是藏在二级菜单），至少露出“当前版本 + 历史数量”
- prompt 入口：在任何出图组件里露出 `提示词` / `effective prompt` 的可展开区域，并支持复制

### Image Studio Lite（流程内“通用图片生成/编辑组件”）

这不是一个独立页面，而是嵌入在资产详情、方案场景卡片等流程里；“弱化但贴合流程”的含义是：

- 默认只展示：当前图 + 主要按钮（生成/重新生成/重新编辑）+ 简要状态
- 高级内容折叠：effective prompt 编辑器、上下文来源（promptContext）、版本列表
- 任何时候都能找到：
  - `查看/编辑提示词`
  - `历史版本`
  - `删除版本/设为主图`

### 全局 AI（Agent）

- 入口明确：按钮 + 快捷键；对话面板可作为侧边抽屉
- “可执行动作”必须显性：AI 回复中区分「建议」与「将要执行的动作」，动作以卡片列出（名称/影响范围/是否可撤销），需要用户确认后执行

## 4) System Feedback（系统反馈：Empty/Loading/Error + 恢复路径）

> 要求：每条都必须包含“用户下一步怎么做/如何恢复”。

### 4.1 Empty States（至少 3 个）

1. **首次启动：无资产、无项目**
   - 展示：一句话解释“先建资产再建项目”的路径；给出 2 个 CTA
     - 主 CTA：`创建第一个场景`
     - 次 CTA：`新建项目（稍后补资产）`（允许先占位创建，进入项目后提示“缺少场景”）
   - 恢复路径：点击 CTA 进入相应创建页，并在创建完成后自动回跳到来源页

2. **资产列表为空（例如：道具为空）**
   - 展示：空插画/占位 + “这个资产会用于哪里”的说明（例：道具会影响方案生成与预览图风格）
   - CTA：`新建道具`、`从图片生成道具描述（可选）`
   - 恢复路径：创建后自动选中该资产并打开详情

3. **未配置 AI Provider（生成按钮不可用）**
   - 展示：按钮 disabled，但旁边给出 inline 提示：`未配置 AI Provider，无法生成`
   - CTA：`去设置`（直达 Settings > Provider）
   - 恢复路径：设置成功后回到原页面，按钮自动恢复可用；保留用户已选资产/已填内容

4. **版本历史为空（某资产/方案还没有生成过图片/方案）**
   - 展示：说明“每次生成都会产生版本，可随时清理”
   - CTA：`生成第一个版本`

### 4.2 Loading States（至少 3 个）

1. **生成方案中（Project > 生成）**
   - 反馈：
     - 生成按钮进入 loading（显示耗时提示，例如“通常 10–30 秒”）
     - 顶部任务队列出现新任务（可打开抽屉查看进度）
   - 可恢复：
     - 提供 `取消`（若支持）或 `稍后通知我`（关闭抽屉也能在完成后提示）
     - 失败后保留输入，允许一键重试

2. **批量生成预览图中（方案页）**
   - 反馈：
     - 总进度：`已完成 x / y`（在页面与任务抽屉都可见）
     - 单卡片进度：每个场景卡片显示 skeleton/转圈 + “生成中”
   - 可恢复：
     - `取消全部`（停止后续任务创建/请求）
     - 支持单张失败重试（不影响其它卡）

3. **设置页拉取模型列表 / 测试连接**
   - 反馈：
     - `拉取模型`按钮 loading
     - 模型列表区域 skeleton
   - 可恢复：
     - 可取消/重试
     - 失败时保留用户输入的 baseUrl/apiKey，不清空表单

4. **上传图片/写入文件中（资产创建/编辑）**
   - 反馈：
     - 上传按钮显示进度
     - 失败时明确“文件未保存/已保存到哪里”
   - 可恢复：
     - 重试上传
     - 更换存储路径（跳转到设置）

### 4.3 Error States（至少 6 个）

1. **无 Key / 未配置 Provider**
   - 文案：`尚未配置 AI Provider，无法生成。`
   - 下一步：`去设置`按钮直达 Provider 配置；提供“为什么需要配置”的一句说明

2. **401/403（鉴权失败）**
   - 文案：`鉴权失败：API Key 无效或已过期。`
   - 下一步：`编辑 Provider`（回填现有配置）+ `重新测试连接`
   - 防误导：提示“不要在截图/日志中分享 Key”

3. **超时 / 网络不可用**
   - 文案：`请求超时或网络不可用。`
   - 下一步：
     - `重试`（保留输入与上下文）
     - `检查网络/代理设置`（可链接到设置页）
   - 桌面特性：若检测到离线，顶部展示轻量离线 banner

4. **模型不支持（text/image 能力不匹配）**
   - 场景：用户选择了 text-only 模型却触发图片生成
   - 文案：`当前模型不支持图片生成，请选择具备 image 能力的模型。`
   - 下一步：`去切换模型`（跳转设置并定位到模型选择）

5. **LLM 返回 JSON 不合法（方案生成解析失败）**
   - 文案：`生成结果格式异常，无法解析为方案。`
   - 下一步：
     - `重新生成`（保持上下文不变）
     - `查看原始输出`（可复制，便于排查；不直接丢给用户一坨不可用内容）

6. **图片生成失败（单张/部分失败）**
   - 文案：`图片生成失败：<具体原因>`（优先透传可读错误）
   - 下一步：
     - 单张：`重试` / `修改提示词后重试`
     - 批量：保留已成功项；失败项提供“逐个重试/全部重试失败项”

7. **本地文件写入失败（磁盘满/无权限）**
   - 文案：`保存失败：磁盘空间不足或无写入权限。`
   - 下一步：`更换存储位置`（跳转设置）/ `重试`

8. **版本删除失败**
   - 文案：`删除失败：文件不存在或本地清理失败。`
   - 下一步：`刷新列表` / `复制错误详情` / `重试`

## 5) Component Detail（核心组件交互细节，与仓库现状对齐）

> 说明：仓库目前顶栏导航见 `src/routes/__root.tsx`；任务抽屉见 `src/components/TaskQueueDrawer.tsx`。本节描述的“侧栏/多面板”是桌面优先的布局建议，可按实现成本分阶段落地。

### 5.1 Sidebar / 导航区（包含历史切换/删除/空态）

- 顶层导航（项目/资产/设置）保持常驻，支持快捷键切换（例如 `⌘1/⌘2/⌘3`）
- “历史/最近”建议以侧栏或面板形式存在（桌面优先）：
  - Projects：最近项目列表 + 搜索
  - Assets：最近使用资产 + 标签筛选
  - 方案/图片版本：在详情页右侧提供“版本列表”（含缩略图/时间/来源）
- 删除入口：
  - 列表项 hover 显示删除按钮
  - 删除必须二次确认；删除“当前版本”时在确认中写清：删除后将自动回退到最近版本（若无则进入空状态）（见 ADR 0004）
- 空态：
  - 最近列表为空时显示“无最近记录”，并给出“去创建/去导入”的 CTA

### 5.2 方案查看页（结果页：单预案 vs 项目预案）

> 目标：在同一套信息架构下兼容两种结构；对 MVP 来说至少要保证“项目方案 + 场景列表 + 预览图”顺畅。

- 通用结构（上→下）：
  1. Header：方案标题、所属项目、当前版本、生成时间、状态（含预览图进度）
  2. 版本切换：版本下拉/列表（含缩略图与差异摘要占位：MVP 先只显示“来源/时间/是否含预览图”）
  3. 内容区：
     - 单预案：分镜场景列表（每个场景卡片含 Image Studio Lite）
     - 项目预案：按 Look 分组，每组下是固定/可变的场景卡片（同样含 Image Studio Lite）
  4. 批量操作：
     - `生成预览图（全部/失败项）`
     - `取消生成`
     - `清理版本`（打开版本管理对话框）
- 场景卡片（每一项都要可独立恢复）：
  - 内容：location/description/shots/lighting
  - 图像：预览图（无则占位）+ 进入 Image Studio Lite（展开 prompt）
  - 错误：卡片内展示，不把错误藏到 toast 里

### 5.3 设置页（Provider 管理、主题示例编辑器）

- Provider 管理：
  - 新建：提供模板（Gemini / OpenAI-compatible）+ 自定义
  - 编辑：baseUrl/apiKey/model（text/image）分区展示，并提示 capability
  - 测试：`测试连接`按钮，失败给出具体原因与下一步
  - 默认：明确“默认 Provider 将用于所有生成”
- 主题示例编辑器（若保留）：
  - 以 JSON 编辑器或列表编辑器呈现
  - 错误提示要指出“哪一项非法/应为字符串数组”

## 6) Copy & Microcopy（文案原则与示例）

原则：

- 错误必须包含：发生了什么 + 为什么（能说就说）+ 下一步怎么做
- 少用“未知错误”；若必须兜底，提供 `复制错误详情` 与 `重试`
- 对危险动作（删除版本/批量清理/批量生成消耗额度）必须二次确认，确认弹窗里写清影响范围

示例（可直接落地）：

- 未配置 Provider：`尚未配置 AI Provider，无法生成。去设置完成配置后即可继续。`
- 生成中：`生成中…你可以先去做别的，完成后会在任务队列提示。`
- 批量生成确认：`将生成全部预览图（共 {n} 张），可能消耗额度。确定继续吗？`
- 批量生成确认：`将生成 {n} 张预览图，可能消耗额度。确定继续吗？`
- 删除版本确认：`将删除该版本的记录与本地文件（不可恢复）。确定删除吗？`
- 删除当前版本确认（示例）：`删除后将自动切换到最近版本；若无版本将进入空状态。确定删除吗？`
- effective prompt 区域标题：`最终提示词（可编辑）`

## 7) A11y 最低要求

- 焦点管理：
  - 抽屉/弹窗打开后 focus trap；关闭后焦点回到触发按钮
  - 版本列表/缩略图支持键盘上下移动与 Enter 选择
- 键盘操作：
  - `Esc` 关闭抽屉/弹窗/展开面板
  - `Enter` 在表单主 CTA（保存/生成）上触发；`⌘Enter` 在 prompt 编辑器中触发生成（可选）
- aria：
  - 图像按钮（生成/删除/设为主图）必须有 `aria-label`
  - 任务状态图标需有可读文本（screen reader）
