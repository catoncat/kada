# 模特资产模块：UX Review（Model Assets）

> FEATURE_SLUG: `model-assets`
> 评审对象：`docs/specs/model-assets/02-ux-spec.md`
> 评审日期：2026-02-12

---

## 1. 问题清单（按严重性）

### Blocker（会导致任务无法完成或不可恢复）

无。UX Spec 覆盖了核心流程的 Happy Path 和主要异常路径，未发现会导致用户任务无法完成的设计缺陷。

### Major（显著增加认知负担/高概率误操作）

| # | 问题 | 位置 | 建议 |
|---|---|---|---|
| M1 | **删除模特时未说明影响范围** | §6 文案清单 | 删除确认文案已包含"已引用该模特的项目映射将失效"，但未列出具体哪些项目引用了该模特。建议：在删除确认弹窗中展示引用该模特的项目数量（如"当前有 2 个项目引用此模特"），帮助用户判断影响。后端可通过查询 `projects.selected_models` 中包含该 modelId 的项目数来实现。V1 可不做完整引用查询，但至少在文案中保留当前的"已引用的项目映射将失效"警告。 |
| M2 | **自动匹配推荐弹窗缺少"已有映射是否覆盖"的说明** | §5.3 自动匹配 | 如果某人物已经手动映射了模特，此时用户点击"自动匹配"，推荐结果会覆盖还是跳过已映射的人物？UX Spec 未明确。建议：默认只推荐未映射的人物；若用户选择"全部应用推荐"，对已映射的人物需二次提示"将覆盖现有映射"。 |
| M3 | **E2 跳转到客户信息后"自动回到模特配置页"的路径不明确** | §4.1 E2 | ProjectWorkspace 是单页滚动布局（不是多页流程），"去填写客户信息"的 CTA 实际上应该是滚动到客户信息区块，而非路由跳转。建议：将"跳转"改为"滚动到客户信息区块并高亮"。 |

### Minor（一致性/微文案/可访问性）

| # | 问题 | 位置 | 建议 |
|---|---|---|---|
| m1 | **模特选择器 Popover 未说明列表为空时的行为** | §5.3 | 如果 Popover 打开后没有匹配当前人物性别/年龄的模特，应展示"无匹配结果" + 底部 `+ 新建模特`。建议在 Component Detail 中补充。 |
| m2 | **卡片中"参考图数量"badge 的计数规则** | §5.1 | 未明确是否包含主参考照。建议：badge 显示"N 张参考图"中的 N = 主参考照(1) + 辅助参考照数量。无主参考照时不显示 badge。 |
| m3 | **年龄范围输入的边界行为** | §5.2 | 未说明 min > max 时的处理。建议：实时校验，min > max 时在 max 输入框下方显示 inline 错误"年龄上限不能小于下限"。 |
| m4 | **项目专属模特的"项目：xxx"标签文案** | §5.1 | 当项目名称过长时标签会挤压卡片布局。建议：项目名称截断至 10 字符 + 省略号。 |
| m5 | **外观提示词建议字数 20-200 字，但无强制约束** | §5.2 | 建议保持"建议"而非"限制"——在 hint 中标注"建议 20-200 字"，但不阻止提交。过短时可给 inline 提示"描述较短，建议补充更多外貌特征以提高一致性"。 |
| m6 | **移除映射（×按钮）不需要二次确认** | §6 | 设计合理（只清除映射，不删除资产），但如果用户不小心点了×，映射会立即丢失。建议：添加 undo toast（"已移除映射 [撤销]"），3 秒内可撤销。V1 可不做 undo，只要用户可以重新选择即可。 |

---

## 2. 状态覆盖检查

### 资产页模特 Tab

| 状态类型 | 场景 | UX Spec 覆盖 | 恢复路径 | 评审结果 |
|---|---|---|---|---|
| Empty | E1: 模特库为空 | ✅ §4.1 E1 | ✅ CTA → 新建表单 | 通过 |
| Loading | L1: 列表加载中 | ✅ §4.2 L1 | ✅ 失败 → ER1 | 通过 |
| Error | ER1: 列表加载失败 | ✅ §4.3 ER1 | ✅ 重试按钮 | 通过 |
| Success | 列表正常展示 | ✅ §5.1 卡片 | — | 通过 |
| Loading | L3: 表单提交中 | ✅ §4.2 L3 | ✅ 失败保留表单 | 通过 |
| Error | ER2: 创建/更新失败 | ✅ §4.3 ER2 | ✅ 保留内容重试 | 通过 |
| Error | ER3: 删除失败 | ✅ §4.3 ER3 | ✅ 重试/取消 | 通过 |
| Loading | L4: 图片上传中 | ✅ §4.2 L4 | ✅ 失败可重试 | 通过 |
| Error | ER5: 上传失败 | ✅ §4.3 ER5 | ✅ 更换路径/重试 | 通过 |
| Error | ER7: 参考图文件丢失 | ✅ §4.3 ER7 | ✅ 占位图，不中断 | 通过 |

### 项目模特配置区块

| 状态类型 | 场景 | UX Spec 覆盖 | 恢复路径 | 评审结果 |
|---|---|---|---|---|
| Empty | E2: 客户信息未填 | ✅ §4.1 E2 | ⚠ 见 M3 | 需调整（滚动 vs 跳转） |
| Empty | E3: 有人物无模特 | ✅ §4.1 E3 | ✅ 新建/去模特库 | 通过 |
| Empty | E4: 有人物有模特未映射 | ✅ §4.1 E4 | ✅ 自动匹配/手动选 | 通过 |
| Loading | L2: 自动匹配中 | ✅ §4.2 L2 | ✅ 超时停止/失败不覆盖 | 通过 |
| Error | ER4: 匹配无结果 | ✅ §4.3 ER4 | ✅ 新建/手动选 | 通过 |
| Error | ER6: 映射悬空 | ✅ §4.3 ER6 | ✅ 重新选择 + 生成不中断 | 通过 |
| Success | 映射完成 | ✅ §5.3 + §5.4 | — | 通过 |

### 生成流程（模特信息注入）

| 状态类型 | 场景 | UX Spec 覆盖 | 恢复路径 | 评审结果 |
|---|---|---|---|---|
| Success | 有映射时 prompt 含模特信息 | ✅ §3 生成时反馈 | — | 通过 |
| Success | 无映射时正常生成 | ✅ §3 向后兼容 | — | 通过 |
| Error | 模特参考图文件丢失 | ✅ §4.3 ER7 | ✅ 静默跳过 | 通过 |
| Error | 模特已删除但映射存在 | ✅ §4.3 ER6 | ✅ 静默跳过 + warning | 通过 |

### 覆盖率总结

- Empty States：4/4 覆盖 ✅
- Loading States：4/4 覆盖 ✅
- Error States：7/7 覆盖 ✅（含 2 个边缘场景 ER6/ER7）
- 每个状态均提供恢复路径 ✅（ER2 的 M3 需微调表述）
- 无"未知错误"兜底文案 ✅

---

## 3. 验收场景（可执行 Checklist）

### 模特资产 CRUD（资产页）

- [ ] **AC01 首次进入模特 Tab**：资产页 Tab 显示"模特"，点击进入，展示空状态（"还没有模特资产" + CTA）
- [ ] **AC02 创建模特（最简）**：点击"新建模特" → 只填名称 → 保存 → 列表出现新卡片（无参考照、无标签）
- [ ] **AC03 创建模特（完整）**：填写名称/性别/年龄范围/描述/外观提示词/标签 + 上传主参考照 + 2 张辅助参考照 → 保存 → 卡片展示所有信息
- [ ] **AC04 编辑模特**：点击卡片 → 修改名称和外观提示词 → 保存 → 卡片更新
- [ ] **AC05 删除模特**：hover 卡片 → 点击删除 → 出现确认弹窗（包含"此操作无法撤销"+"已引用的项目映射将失效"） → 确认 → 卡片消失
- [ ] **AC06 名称校验**：新建表单名称为空时点保存 → 不提交，显示校验错误
- [ ] **AC07 图片上传**：上传主参考照 → 预览显示 → 替换为新图片 → 保存后生效
- [ ] **AC08 辅助参考照上限**：上传第 6 张辅助参考照 → 被阻止或提示"最多 5 张"

### 项目模特配置

- [ ] **AC09 无客户信息引导**：新建项目（未填客户信息）→ 模特配置区块显示"请先填写客户信息"+ CTA
- [ ] **AC10 有人物无模特引导**：填写客户信息（2 人）→ 模特库为空 → 配置区块显示"暂无可用模特" + "新建模特"/"去模特库"
- [ ] **AC11 手动选择模特**：填写客户信息 → 模特库有模特 → 点击"选择模特" → 选择 → 映射显示在人物行
- [ ] **AC12 更换映射**：已映射 → 点击"更换" → 选择另一个模特 → 映射更新
- [ ] **AC13 移除映射**：已映射 → 点击"×" → 映射被清除，人物行恢复"选择模特"状态
- [ ] **AC14 自动匹配**：2 个人物 + 有匹配的模特 → 点击"自动匹配" → 推荐弹窗展示 → 全部应用 → 映射写入
- [ ] **AC15 自动匹配无结果**：人物性别/年龄无匹配的模特 → 自动匹配 → 提示"未找到匹配的模特" + "新建模特"/"手动选择"
- [ ] **AC16 配置状态 badge**：未配置=灰色"未配置"，部分配置=灰色"已配置 1/2"，全部配置=绿色"已配置 2/2"
- [ ] **AC17 持久化验证**：映射完成 → 刷新页面 → 映射仍然存在
- [ ] **AC18 快速创建项目模特**：在配置区块点击"新建模特" → 表单弹窗 → 保存 → 模特自动为项目专属（projectId 已填） → 可在选择器中看到

### 生成与一致性（端到端）

- [ ] **AC19 模特信息注入**：有映射 → 生成预览图 → Image Studio Lite 的 effectivePrompt 中包含"## 人物外观描述"段落，内容为映射模特的 appearancePrompt
- [ ] **AC20 参考图注入**：有映射且模特有参考照 → 生成预览图 → 请求中的 referenceImages 包含模特参考照片
- [ ] **AC21 向后兼容（无映射）**：不配置模特 → 生成方案和预览图 → 流程正常，effectivePrompt 无 modelInfo 段落
- [ ] **AC22 中文 visualPrompt**：生成方案 → 查看预案中的 visualPrompt → 为中文描述（非英文 SD 风格）
- [ ] **AC23 映射悬空容错**：映射模特 A → 在资产页删除模特 A → 回到项目 → 配置区块显示"⚠ 模特已被删除" → 生成预览图不中断

### 边缘场景

- [ ] **AC24 参考图上限**：模特有 1 主参考 + 5 辅助参考，场景资产有 1 主图 + 1 补充图 → 生成请求的参考图总数 ≤ 8 张
- [ ] **AC25 多人物映射同一模特**：2 个人物映射同一个模特 → 生成时 effectivePrompt 中该模特信息出现 2 次（分别对应不同人物角色）→ referenceImages 不重复

---

## 4. 文案与反馈质量检查

### 禁止"未知错误"检查

| 场景 | UX Spec 文案 | 是否避免"未知错误" | 评审 |
|---|---|---|---|
| ER1 列表加载失败 | `加载失败：<具体原因>` | ✅ 透传具体原因 | 通过 |
| ER2 创建/更新失败 | `保存失败：<具体原因>` | ✅ 含"名称不能为空"等具体示例 | 通过 |
| ER3 删除失败 | `删除失败：<具体原因>` | ✅ 透传具体原因 | 通过 |
| ER4 匹配无结果 | `未找到匹配的模特：模特库中没有与当前人物性别/年龄匹配的资产` | ✅ 明确原因 | 通过 |
| ER5 上传失败 | `上传失败：磁盘空间不足或无写入权限` | ✅ 具体原因 | 通过 |
| ER6 映射悬空 | `⚠ 模特已被删除，请重新选择` | ✅ 明确原因 + 动作 | 通过 |

### 错误文案"原因 + 下一步"模式检查

| 场景 | 原因 | 下一步动作 | 评审 |
|---|---|---|---|
| ER1 | ✅ 具体原因 | ✅ 重试按钮 | 通过 |
| ER2 | ✅ 具体原因 | ✅ 保留内容重试 | 通过 |
| ER3 | ✅ 具体原因 | ✅ 重试/取消 | 通过 |
| ER4 | ✅ 无匹配 | ✅ 新建/手动选 | 通过 |
| ER5 | ✅ 磁盘/权限 | ✅ 更换路径/重试 | 通过 |
| ER6 | ✅ 已删除 | ✅ 重新选择 | 通过 |
| ER7 | ✅ 文件丢失 | ✅ 占位图（不打扰） | 通过 |

### 二次确认检查

| 危险操作 | 是否有二次确认 | 文案是否说明影响 | 评审 |
|---|---|---|---|
| 删除模特 | ✅ confirm | ✅ "无法撤销" + "项目映射失效" | 通过 |
| 移除映射 | ❌ 无需（只清映射） | — | 通过（合理） |
| 自动匹配覆盖已有映射 | ⚠ 见 M2 | 未明确 | 建议补充 |

### 文案一致性检查

- ✅ 全部使用"模特"而非"模型"
- ✅ 可选步骤均标注"可选"和跳过后果
- ✅ 外观提示词区域有具体示例引导
- ✅ 保存/删除操作有 toast 反馈

---

## 5. 总结

| 严重性 | 数量 | 状态 |
|---|---|---|
| Blocker | 0 | — |
| Major | 3 | M1 可 V2 做；M2/M3 建议实现前明确 |
| Minor | 6 | 均为优化建议，不阻塞实现 |

**评审结论**：UX Spec 质量合格，状态覆盖完整（4 Empty + 4 Loading + 7 Error），所有错误状态均有恢复路径且无"未知错误"。3 个 Major 问题中 M3（滚动 vs 跳转）在实现时需明确，M1 和 M2 可标记为 V2 优化。验收场景共 25 条，覆盖首次使用、CRUD、映射、自动匹配、端到端生成、向后兼容和边缘场景。
