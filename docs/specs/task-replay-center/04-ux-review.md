# UX 评审与验收清单（task-replay-center）

> 评审输入：`docs/specs/task-replay-center/02-ux-spec.md`、`docs/product/user-flows.md`  
> 评审目标：把任务复盘中心 UX Spec 转成可执行验收清单，并识别阻塞性 UX 风险（重点 Empty/Loading/Error 与可恢复路径）。

## 1) 问题清单（按严重性）

### Blocker（已定稿规则，未实施前仍视为阻塞）

1. **Provider 策略已定稿：按任务类型分流**
   - 规则：
     - `plan-generation`：存在可用文本能力（在线或本地降级）时允许重放。
     - `image-generation`：无可用图片能力时禁止重放并引导去设置。
   - 未实施风险：前后端若未按同一规则执行，验收仍会分裂。

2. **Replay 幂等已定稿：前端锁 + 后端 requestId 去重**
   - 规则：
     - 前端点击后立即锁按钮。
     - 后端基于 `requestId` 在幂等窗口内去重，重复请求返回同一 `taskId`。
   - 未实施风险：重复任务、额度浪费、复盘噪声。

3. **深链恢复已定稿：任务不存在时必须给恢复页**
   - 规则：
     - 不允许仅显示裸 404。
     - 必须提供 `返回任务列表`、`查看同来源最近任务`、`跳转来源页面` 三个动作。
   - 未实施风险：用户从通知/外链进入后流程中断。

### Major（显著增加认知负担/高概率误操作）

1. **Loading 场景混入非本功能主线**
   - `拉模型列表/测试连接`属于设置页流程，不是任务复盘中心核心流。
   - 风险：验收焦点分散，主流程（定位任务→复盘→恢复）覆盖不足。

2. **Success 状态定义偏弱**
   - Empty/Loading/Error 定义充分，但“重放成功、复制成功、来源跳转成功、筛选重置成功”缺统一反馈规范。
   - 风险：用户完成动作后不确定是否生效，反复点击。

3. **“可重试”与“可重放”语义仍可能混淆**
   - UX 中两者都有，但缺对比文案（是否复用原 task、是否创建新 task、是否覆盖历史）。
   - 风险：误操作后难理解任务数量增长原因。

4. **旧数据缺字段时仅提示，不足以指导下一步**
   - 目前写“部分字段未记录”，但未规定默认主操作（例如优先给“按原参数重放”或“跳来源补录”）。
   - 风险：用户看完提示仍不知道先做什么。

### Minor（一致性/微文案/可访问性）

1. 术语建议全站统一：
   - `重试`（针对失败任务）
   - `按原参数再生成`（针对任意任务，创建新任务）
2. `复制复盘信息`建议明确复制内容范围（prompt/参数/错误/ID）。
3. A11y 需补充“筛选变化后朗读结果数”的辅助说明，提升键盘与读屏可用性。

## 2) 状态覆盖检查（逐条对照 UX Spec）

### 2.1 Empty

| 条目 | 是否覆盖 | 是否有“下一步/恢复” | 评审结论 |
| --- | --- | --- | --- |
| 首次进入无任务 | 是 | 是（去项目页） | 通过 |
| 筛选后无结果 | 是 | 是（清空筛选） | 通过 |
| Provider 不可用 | 是 | 是（按任务类型分流：降级执行或去设置） | 通过 |

### 2.2 Loading

| 条目 | 是否覆盖 | 是否有“下一步/恢复” | 评审结论 |
| --- | --- | --- | --- |
| 提交重试/再生成 | 是 | 是（查看新任务/轮询） | 通过 |
| 批量任务局部完成刷新 | 是 | 是（仅重试失败项） | 通过 |
| 拉模型/测试连接 | 是 | 是（重试/检查网络） | 通过（但建议降级为跨页补充场景） |

### 2.3 Error

| 条目 | 是否覆盖 | 是否有“下一步/恢复” | 评审结论 |
| --- | --- | --- | --- |
| 无 Key / 未配置 Provider | 是 | 是（去设置） | 通过 |
| 401/403 | 是 | 是（编辑配置并重测） | 通过 |
| 超时/网络不可用 | 是 | 是（重试） | 通过 |
| 模型能力不匹配 | 是 | 是（切换模型） | 通过 |
| JSON 不合法 | 是 | 是（查看原始输出/重跑） | 通过 |
| 图片生成失败（含部分失败） | 是 | 是（单项或失败项重试） | 通过 |
| 旧数据缺字段 | 是 | 是（查看可用字段/重放） | 通过（建议强化主操作） |

### 2.4 Success

| 条目 | 当前定义 | 建议 |
| --- | --- | --- |
| 重放成功 | 弱定义 | 显示“已创建新任务 #ID”，并提供一键跳转 |
| 重试成功 | 弱定义 | 在原任务卡保留“重试于 xx:xx”标记 |
| 复制成功 | 弱定义 | 明确“已复制 prompt+参数+错误摘要” |
| 来源跳转成功 | 弱定义 | 跳转后给“已定位到场景 X”轻提示 |

结论：
- Empty/Loading/Error 覆盖总体完整。
- Success 需要补成强规范，否则验收仍会出现“行为成功但用户感知失败”。

## 3) 验收场景（可执行，14 条）

1. **首次进入任务中心无历史**
   - 前置：清空任务数据。
   - 操作：打开任务中心。
   - 期望：展示空态与“去项目页”CTA，点击后可进入项目页。

2. **筛选后无结果**
   - 前置：存在任务，但当前筛选条件不匹配。
   - 操作：切换筛选。
   - 期望：展示“无匹配任务”与“清空筛选”，点击后恢复列表。

3. **打开失败任务详情**
   - 前置：有 `failed` 任务。
   - 操作：点击任务。
   - 期望：详情可见错误原因、重试按钮、复制错误信息按钮。

4. **重试失败任务**
   - 前置：失败任务可重试。
   - 操作：点击“重试”。
   - 期望：按钮进入 loading，生成新状态反馈；任务可继续轮询。

5. **按原参数再生成（已完成任务）**
   - 前置：有 `completed` 任务。
   - 操作：点击“按原参数再生成”并确认。
   - 期望：创建新任务，原任务保持不变，新任务可被定位。

6. **防连点校验**
   - 前置：网络较慢。
   - 操作：连续快速点击“按原参数再生成”。
   - 期望：不会产生重复任务，或明确提示“已在创建中”。

7. **image-generation 参数复盘完整性**
   - 前置：有图像任务。
   - 操作：查看详情。
   - 期望：至少看到 draft/effective prompt、referenceImages、owner、artifact/run 信息。

8. **旧数据缺字段兼容**
   - 前置：导入一条无 run/artifacts 的旧任务。
   - 操作：打开详情。
   - 期望：不崩溃，显示“部分字段未记录”，且仍可执行恢复动作。

9. **网络超时加载详情失败**
   - 前置：模拟 `/api/tasks/:id/detail` 超时。
   - 操作：打开任务详情。
   - 期望：出现可读错误 + 重试入口；重试后恢复。

10. **401/403 恢复路径**
    - 前置：Provider 凭据无效。
    - 操作：触发重试或重放。
    - 期望：提示鉴权失败，提供“去设置”入口，返回后可继续操作。

11. **模型能力不支持**
    - 前置：模型不支持当前任务类型（如 image 能力缺失）。
    - 操作：执行重放。
    - 期望：提示能力不匹配并可直达切换模型。

12. **部分失败场景恢复**
    - 前置：批量相关任务中部分失败。
    - 操作：执行“仅重试失败项”。
    - 期望：成功项保留，失败项单独重试并产生新记录。

13. **来源跳转定位**
    - 前置：`planScene` 任务带 scene 信息。
    - 操作：从任务详情点击“跳转来源”。
    - 期望：进入结果页并定位到正确场景。

14. **删除任务后的深链恢复**
    - 前置：删除某任务后仍持有其深链。
    - 操作：访问该深链或从通知打开。
    - 期望：提示“任务不存在或已删除”，并提供返回列表与最近任务入口。

## 4) 文案与反馈质量检查

### 4.1 硬性规则

1. 禁止只显示“未知错误”。
2. 每条错误文案必须包含：
   - 发生了什么
   - 可判定原因
   - 下一步动作
3. 每个失败态至少有一个可执行恢复动作（重试/去设置/切模型/跳来源）。
4. 高风险操作（删除、重放可能消耗额度）必须二次确认并写明影响范围。

### 4.2 建议文案模板

- 重放确认：`将基于当前参数创建新任务，原任务不会被覆盖。继续吗？`
- 重放成功：`已创建新任务（{taskId}），你可以立即查看执行进度。`
- Provider 不可用：`当前 Provider 不可用，暂时无法执行该操作。请先完成配置。`
- 模型不支持：`当前模型不支持该任务类型，请切换到具备对应能力的模型。`
- 旧数据提示：`该记录来自旧版本，部分字段未记录。建议重放一次以补齐可追溯信息。`
- 删除后深链：`该任务已不存在，你可以返回任务列表继续处理最近任务。`

## 5) 结论

- 当前 `task-replay-center` UX Spec 在状态覆盖方面整体达标，尤其是 Error 场景与恢复路径设计较完整。
- 3 个 Blocker 口径已定稿，当前阶段重点转为“严格按口径实施并回归验证”。
- 建议将 Success 反馈补成强规范并与实现一并验收，可显著减少“功能成功但用户不确定”的体验损耗。
