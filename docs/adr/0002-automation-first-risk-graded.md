# ADR 0002：默认自动化优先（按风险分级 + 可追溯/可撤销）

## 背景

`desktop-mvp-foundation` 的产品目标是：让摄影工作室把“场景/道具/服装/创意方案/提示词”等沉淀为可复用资产，并在项目流程中用 AI 快速生成新的创意方案与预览图。

用户明确的体验偏好是：

- 更自动化、更省事（减少来回点选与重复填写）
- UI 保持极简，但信息输出要足够（尤其是版本、提示词、任务进度等“可控性信息”）
- 不做“教学式引导”，好的 UI 本身就是引导

但“更自动化”不是免费午餐，会引入：

- **信任成本**：AI 若“擅自做事”（删除/批量改动/消耗额度/写文件）会直接破坏信任
- **状态复杂度**：更多后台任务（生成/批量/版本）意味着更多 Loading/Error 分支与恢复路径
- **可解释性要求**：用户必须能知道“这张图/这版方案到底用了什么 prompt/上下文”，否则无法复用与稳定迭代

因此需要先确定本期交互基调：在“保守可控”与“自动化省事”之间如何取舍，并明确护栏。

## 选项

1. 选项 A：**自动化优先（按风险分级）**
   - 低风险动作默认自动执行（例如：生成草稿、生成封面预览图在用户授权后自动触发）
   - 中高风险动作必须显性确认（例如：删除版本、批量修改、可能消耗较多额度的批量生图）
   - 所有生成/编辑默认版本化（不覆盖旧版本），并提供清理能力
   - 任务队列可见，长耗时任务可取消/重试，失败可追溯

2. 选项 B：可控优先（强手动、强确认）
   - 默认不自动触发任何生成；每一步都由用户显式点击确认
   - UI 状态相对简单、误触风险低
   - 代价是效率低、上下文拼接与重复操作成本高，难以达到“AI 原生”体验

3. 选项 C：建议优先（AI 只建议不执行）
   - AI 产出“建议/草案/下一步按钮”，但不直接调用内部 API 执行动作
   - 风险最低，但用户仍需要手动完成大部分操作；与“用自然语言直接管理流程”的愿景偏离

## 决策

选择 **选项 A：自动化优先（按风险分级）**。

理由：

- 用户已明确选择 “A”，并偏好“极简但信息密度高”的桌面工作流
- 该策略与“AI 原生（同一套能力层 API 同时服务 UI 与 AI Agent）”一致
- 通过风险分级 + 版本化 + 可观测任务队列，可以把自动化带来的信任风险控制在可接受范围内

## 后果（Trade-offs）

- 正面影响：
  - 形成“桌面生产力工具”的顺滑体验：更少点击、更快产出
  - 与版本系统结合后，用户敢于尝试（失败可回退，历史可清理）
  - 为未来 Phase B 的全局 Agent/Skills 打下同一套安全模型与能力层 API

- 负面影响 / 代价：
  - 实现成本更高：需要风险分级、确认弹窗、任务队列、版本指针、清理与空间反馈
  - 状态机更复杂：必须补齐 Empty/Loading/Error/Success 的一致恢复路径
  - 需要明确“成本/额度”提示，否则自动化会反噬信任（尤其是自动生成预览图）

- 落地要求（护栏）：
  - **风险分级**：每个可执行动作都要标注风险等级与影响范围；高风险动作必须二次确认
  - **版本化默认开启**：任何生成/编辑都创建新版本，不覆盖旧版本；删除当前版本必须有安全规则
  - **effective prompt 一致性**：UI 展示/编辑的最终提示词必须与服务端实际使用并回显的 prompt 一致
  - **任务队列可观测**：生成类动作进入队列；至少保留失败/最近记录以保证“可恢复”
  - **自动预览图的授权**：首次自动触发前必须告知张数与可能消耗额度，并允许用户记住选择

- 对现有代码/数据的迁移要求：
  - 从“前端持有 base64 结果”逐步迁移到“产物落盘 + artifact/版本元信息入库”的模型
  - `docs/engineering/contracts.md` 与 `docs/engineering/api.md` 需要补齐 Generation/Artifact/版本指针，以成为后续实现的真相源

