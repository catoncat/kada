# 用户流程与界面状态

本产品目前是单路由应用（`/`），但有清晰的**状态机**：空白页 → 生成中 → 结果页（单预案/项目预案）→ 历史切换。

## 1) 普通主题：生成单预案

1. 用户输入主题或点击“示例主题/最近使用”
2. 点击“生成”
3. 文生文返回 JSON（中文字段 + `visualPrompt` 英文）
4. 结果页展示：概览、创意思路、核心文案、分镜规划（逐场景）
5. 用户可对每个场景：
   - 编辑 `visualPrompt`（英文）
   - 点击“生成参考图/重新生成”
6. 可选：点击“生成全部参考图”（带确认提示，避免误触消耗额度）
7. 点击“导出 PPT”（可选 PPT 风格）

关键状态与约束：
- 未配置在线 Provider 时：仍可生成文本（走本地/降级逻辑），但**图片生成会失败**（因为需要 `/api/ai/generate-image` + API Key）。
- 编辑提示词不会自动持久化：当前实现是点击“重新生成”时才会把新 prompt 写回历史记录。

## 2) 三套服装：生成项目预案

1. 切换到“3 套服装”模式
2. 输入客户信息（年龄必填、性别、用途可选）
3. 添加 1–3 套服装（名称必填，可填颜色/材质/标签/叠搭模板/备注）
4. 选择全局风格锚点（色调/光线氛围/时代感）
5. 点击“生成三套预案”
6. 结果页展示：项目概览、每套 Look 的 4 场景卡片
7. 参考图默认不自动生成：逐场景点击生成，或“一键生成全部参考图”
8. 导出：
   - “导出项目 PPT”（文本为主）
   - “导出（含参考图）”（仅在已生成至少 1 张参考图时可用）

关键状态与约束：
- 项目模式下场景固定为 4 个（主场景、叠搭A、叠搭B、纯色版面），便于后续模板化与导出排版。
- 纯色版面包含 `cutoutSpec`（背景/打光/构图留白），用于指导抠图与版面。

## 3) 历史记录

- 左侧 Sidebar 展示最近历史（上限 20 条）。
- 点击历史项可回到对应预案；支持删除历史项。
- 当前历史存储在 localStorage（`shooting_history`），**不是** Sidecar DB。

## 4) 设置（右下角浮动按钮）

### 服务商（Provider）
- 添加：支持预设模板（Google AI Studio / OpenRouter）或自定义
- 编辑：支持切换格式（Gemini 原生 / OpenAI 兼容）
- 拉取模型：调用 `/api/ai/models` 并按能力分类（text/image）
- 设置默认：默认 Provider 会用于后续调用

### 主题提示词
- JSON 编辑器（字符串数组），控制首页“示例主题”的展示。

